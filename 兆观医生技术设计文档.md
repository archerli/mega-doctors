## 概览

根据《兆观医生》产品需求文档，进行技术选型和设计。

## 服务端技术调研

**微信服务开发**

- Access-Token服务
- 小程序模板消息

**IM系统**

**短信服务**

**其他服务**

- 医生微信邀请二维码生成

## 表结构设计

- **Patients** 患者信息表
- **Doctor** 医生信息表
- **Consultation** 医生患者咨询关系表
- **DoctorPatientRelation** 医生患者交互信息表

### Patients

| 字段     | 类型    | 描述 |
| -------- | ------- | ---- |
| objectId | Pointer | UID  |
| name     | String  | 姓名 |
| gender   | String  | 性别 |
| birthday | String  | 生日 |
| height   | String  | 身高 |
| weight   | String  | 体重 |
| phone    | String  | 联系电话 |
| icon     | File    | 头像 |
| location | String  | 用户位置，所在城市 |

### Doctor

| 字段     | 类型    | 描述         |
| -------- | ------- | ------------ |
| objectId | Pointer | UID          |
| openid   | String  | 小程序openid |
| name     | String  | 姓名 |
| gender   | String  | 性别 |
| phone    | String  | 联系电话 |
| icon     | File    | 头像 |
| hospital | String  | 所在医院 |
| department | String | 所在科室 |
| title    | String  | 职称 |
| authenticated | String | 是否认证，0：否，1：是，2：认证中 |
| certificate   | File    | 医师资格证 |
| licence  | File    | 医生执业证 |
| startConsultation     | Boolean | 是否开启咨询 |
| startConsultationTime | String  | 开启咨询时间 |
| endConsultationTime   | String  | 结束咨询时间 |

### Consultation

| 字段     | 类型    | 描述     |
| -------- | ------- | -------- |
| objectId | Pointer | UID      |
| idDoctor | Pointer | 关联医生     |
| idPatient | Pointer | 关联患者     |
| status   | String  | 咨询状态 |
| idDialog | Pointer | 对话列表（IM系统，关联单次会话ID） |

status:

- 0：新咨询
- 1：回复中
- 2：已结束

对话列表：

```
[
  {
    content: String|File
    type: String
  }
]
```

type:

  - text: 文本类型
  - image: 图片类型
  - link: 链接类型

### DoctorPatientRelation

| 字段     | 类型    | 描述     |
| -------- | ------- | -------- |
| objectId | Pointer | UID      |
| idDoctor | Pointer | 关联医生     |
| idPatient | Pointer | 关联患者     |
| tag      | Array   | 标签 |
| remark   | String | 备注 |
| source | String | 用户来源 |
| follow | Boolean | 是否关注 |
| block | Boolean | 是否屏蔽 |
| group | Array | 分组 |

group:

- 1：普通的
- 2：关注的
- ~~3：付费过~~
- ~~4：VIP患者~~

source：

- 0：扫码